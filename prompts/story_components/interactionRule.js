// prompts/story_components/interactionRule.js

/**
 * @returns {string} The rule text for the NPC interaction systems (Friendliness and Combat).
 */
const getInteractionRule = () => {
    return `
## 友好度系統 (非常重要)：
你必須使用以下7個層級來定義NPC對玩家的態度。友好度的變化必須基於玩家的行為和故事發展。
-   **崇拜 (devoted)**: NPC將玩家視為偶像或恩人，願意為玩家付出一切。
-   **信賴 (trusted)**: NPC完全信任玩家，視玩家為可靠的盟友或摯友。
-   **友善 (friendly)**: NPC對玩家抱有好感，樂於交流和提供幫助。
-   **中立 (neutral)**: NPC對玩家沒有預設立場，態度會根據玩家的行為而改變。
-   **警惕 (wary)**: NPC對玩家抱有疑慮或戒心，會保持距離，互動謹慎。
-   **敵對 (hostile)**: NPC將玩家視為敵人，可能會主動挑釁或攻擊。
-   **死敵 (sworn_enemy)**: NPC與玩家有不共戴天之仇，會不惜一切代價與玩家為敵。

## 戰鬥模式規則 (非常重要)：
當劇情發展到可能發生武力衝突或武藝較量時，你必須遵循以下規則來判斷是否觸發戰鬥系統。

1.  **觸發時機 (雙向原則)**:
    * **玩家發起**: 當玩家的行動明確表示要與人動手時（例如：「攻擊山賊」、「與林教頭切磋」），或邀請盟友助戰時（例如：「我們一起上！」）。
    * **NPC發起**: 當NPC的行動或對白表現出強烈的互動意圖時（例如：山賊大喝「拿命來！」、武師邀請「來比劃比劃？」）。

2.  **【核心修改】交鋒與盟友判斷**:
    * 在判定一方發起互動後，你**必須**先決定現場其他NPC的反應。
    * **判定盟友**: 如果現場有玩家的友方NPC（友好度為 'friendly', 'trusted', 'devoted'），且玩家的指令包含「一起上」、「幫我」等請求，或者NPC的個性是「忠誠」或「義氣」，你應該判斷其加入戰鬥成為盟友。
    * **判定敵人**: 確認最終的敵對目標。
    * **進入戰鬥**: 如果最終確定將進入交鋒，你必須在回傳的 \`roundData\` 中，額外加入以下欄位：
        1.  \`"enterCombat": true\`
        2.  \`"combatants"\`: 一個包含所有**對手**姓名和初始狀態的物件陣列。
        3.  \`"allies"\` (可選): 一個包含所有參戰**盟友**姓名和初始狀態的物件陣列。如果沒有盟友，則**不要**包含此欄位。
        4.  \`"combatIntro"\`: (字串) 一段約50-100字的文字，生動地描述戰鬥發生的原因、敵我陣容或場景氛圍。
    * **如果任何一方選擇逃離、拒絕或退讓**，則**不應**觸發戰鬥。你的 "story" 敘述應專注於描述該情節，並且**絕對不能**包含 \`enterCombat\` 欄位。

3.  **【再次強調的禁令】**: 當你判斷應觸發戰鬥系統時，你的 "story" 敘述應該在戰鬥**發生之前**就結束。你**絕對禁止**自行推演戰鬥過程或直接在你的 "story" 中給出任何戰鬥結果。將詳細的戰鬥過程交給後續的「戰鬥裁判」AI。

4.  **例外情況**：如果對手是完全不會武功的平民，且玩家對其使用暴力，則直接在故事中描述結果，**不要**觸發戰鬥系統。
`;
};

module.exports = { getInteractionRule };
