// prompts/story_components/npcRule.js

/**
 * @returns {string} The rule text for the NPC data structure.
 */
const getNpcRule = () => {
    return `
## 【***最終版***】NPC資料結構新規則 (最重要)：
當你生成與NPC的互動時，你**必須**為 \`NPC\` 陣列中的每個NPC物件，提供以下所有欄位：

1.  **\`name\` (字串)**: NPC的真實姓名。
2.  **\`status\` (字串)**: 描述NPC當下的外觀或行為。
3.  **\`friendliness\` (字串)**: 描述NPC**當下**的態度。必須是以下7個層級之一：\`devoted\`, \`trusted\`, \`friendly\`, \`neutral\`, \`wary\`, \`hostile\`, \`sworn_enemy\`。
4.  **\`friendlinessChange\` (數字)**: 本回合玩家的行動對該NPC友好度造成的**具體數值變化**。一個善意的舉動可能回傳 \`10\`，一個冒犯的行為可能回傳 \`-15\`。如果沒有任何影響關係的互動，**必須**回傳 \`0\`。
5.  **\`isNew\` (布林值, 可選)**: **只有在**玩家**首次**遭遇這位NPC時，才**必須**包含此欄位且設為 \`true\`。再次遇到時，**絕對不能**包含此欄位。
6.  **\`isDeceased\` (布林值, 可選)**: **只有在**這位NPC在本回合死亡時，才**必須**包含此欄位且設為 \`true\`。

**範例一：玩家首次遇到王大夫並得到幫助**
\`\`\`json
"NPC": [
  {
    "name": "王大夫",
    "status": "他仔細為你診脈，神情專注。",
    "friendliness": "neutral",
    "friendlinessChange": 5,
    "isNew": true
  }
]
\`\`\`
**範例二：玩家再次遇到王大夫，並激怒了他**
\`\`\`json
"NPC": [
  {
    "name": "王大夫",
    "status": "他皺起了眉頭，看起來有些不悅。",
    "friendliness": "wary",
    "friendlinessChange": -10
  }
]
\`\`\`
---

當你生成與NPC的互動時，必須區分以下兩種情況：

### 情況一：**首次**遇到NPC
-   當玩家**首次**遭遇一位重要的（可能再次出現的）NPC時，你的任務是**簡單**地標記這位新NPC。
-   **【核心命名鐵律】** 在回傳的 \`NPC\` 陣列中，你生成的NPC物件，其 \`"name"\` 欄位**必須**是一個符合當下情境與金庸武俠風格的**真實姓名** (例如："林婉兒"、"蕭半絕"、"王二嬸")。**絕對禁止**使用 "少女村民"、"中年婦女"、"竹籃少年" 等通用描述作為姓名。
-   你可以在 \`"status"\` 欄位中，繼續使用通用描述來形容該NPC的初登場樣貌。例如：\`"status": "一位正在河邊洗衣服的年輕少婦，眉間帶著淡淡的憂愁。"\`
-   這個物件**只能**包含四個鍵：\`"name"\` (真實姓名)、\`"status"\` (狀態描述)、\`"friendliness"\`，以及最重要的**\`"isNew": true\`**。
-   **【絕對禁止】** 在這個階段**不要**生成詳細的背景、個性、裝備等資訊，那將由另一個AI在背景完成。

### 情況二：再次遇到已知的NPC
-   當玩家與之前見過面的NPC重逢時，你需要在 \`NPC\` 陣列中提供一個包含該角色更新後狀態的完整物件。
-   這個物件應包含 \`"name"\`、\`"status"\`、更新後的 \`"friendliness"\`，以及該角色的 \`"personality"\`（此資訊應從舊摘要中獲取）。
-   **【嚴格規則】** 在這種情況下，**絕對不能**包含 \`isNew\` 這個鍵。
-   如果這位NPC在本回合的劇情中死亡，你必須在其物件中，額外加入一個 **\`"isDeceased": true\`** 的欄位。

---
## 【參考用】給「人物設定師AI」的詳細NPC檔案範本
(這不是你的任務，但有助於你理解我們最終要如何擴展新的NPC物件)
\`\`\`json
{
  "npcId": "王大夫",
  "name": "王大夫",
  "gender": "男",
  "isDeceased": false,
  "allegiance": "中立善良",
  "isRomanceable": true,
  "romanceOrientation": "異性戀",
  "romanceValue": 0,
  "personality": ["仁厚", "謹慎", "略帶迂腐"],
  "goals": ["找出治癒女兒絕症的方法(雖然已故)", "守護無名村的安寧"],
  "secrets": "年輕時曾是江湖組織「藥王谷」的弟子，因故叛逃。",
  "skills": ["基礎藥理", "針灸術", "防身用匕首短打"],
  "voice": "聲音溫和，語速偏慢，帶有書卷氣。",
  "habit": "思考時習慣性地輕捻自己的山羊鬍。",
  "background": "世代行醫，是無名村唯一的郎中，醫術不算頂尖但宅心仁厚，深受村民信賴。年輕時似乎也曾闖蕩江湖，但對往事絕口不提。",
  "firstMet": {
    "round": 1,
    "time": "元祐元年一月一日 上午",
    "location": "無名村藥鋪",
    "event": "主角身受重傷，被其所救"
  },
  "appearance": "年約五旬，身形偏瘦，留著山羊鬍，眼神中總是帶著一絲憂慮，身上常年有淡淡的藥草味。",
  "equipment": ["藥箱", "銀針", "一把陳舊的匕首"],
  "relationships": {
    "family": ["女兒：小蓮 (已故)"],
    "friends": ["李鐵匠"],
    "enemies": ["黑風寨山賊"],
    "lover": "妻子 (已故)"
  },
  "quests": {
    "completed": ["尋找止血草"],
    "uncompleted": ["調查後山異響"]
  },
  "knowledge": ["基礎藥理", "村莊附近的傳聞"],
  "belief": "信奉醫者父母心，救人一命勝造七級浮屠。",
  "preferences": {
    "likes": ["研究疑難雜症", "清靜", "懂禮貌的年輕人"],
    "dislikes": ["打打殺殺", "浪費藥材", "傲慢無禮之徒"]
  },
  "orientation": "異性戀",
  "miscNotes": "似乎對主角異於常人的體質非常感興趣。"
}
\`\`\`
`;
};

module.exports = { getNpcRule };
