<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 文字江湖</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script> <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/game.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/modals_feedback.css">
    <link rel="stylesheet" href="styles/modals_interaction.css">
    <link rel="stylesheet" href="styles/modals_info.css">
    <link rel="stylesheet" href="styles/gmPanel.css">
    <link rel="stylesheet" href="styles/trade.css">
</head>
<body class="light-theme">
    <div class="game-container">
        <button id="menu-toggle" class="menu-toggle"><i class="fas fa-bars"></i></button>

        <main id="main-content" class="main-content">
            <header class="story-header">
                <div id="status-bar" class="status-bar">
                    <div class="status-item" id="date-status"><i class="fas fa-calendar-alt"></i> 日期: --</div>
                    <div class="status-item" id="time-status"><i class="fas fa-clock"></i> 時辰: --</div>
                </div>
                <button id="header-toggle-btn" class="header-toggle-btn" title="收起/展開資訊欄">
                    <i class="fas fa-chevron-up"></i>
                </button>
            </header>
            <div id="story-panel" class="story-panel">
                <div id="story-text-wrapper">
                     <p class="system-message">正在連接你的世界，讀取記憶中...</p>
                </div>
                 <div id="npc-interaction-menu" class="npc-interaction-menu"></div>
            </div>
            <footer class="story-footer">
                <div id="action-suggestion" class="action-suggestion"></div>
                <div class="input-action-wrapper">
                    <input type="text" id="player-input" placeholder="接下來..." autocomplete="off">
                    <button id="submit-button">動作</button>
                </div>
            </footer>
        </main>

        <aside id="dashboard" class="dashboard">
            <div class="dashboard-header">
                <div class="header-buttons">
                    <a href="novel.html" target="_blank" class="header-link-btn" title="閱讀完整小說">
                        <i class="fas fa-book-open"></i>
                    </a>
                    <a href="relations.html" target="_blank" class="header-link-btn" title="人物關係圖">
                        <i class="fas fa-project-diagram"></i>
                    </a>
                    <a href="encyclopedia.html" target="_blank" class="header-link-btn" title="江湖百科">
                        <i class="fas fa-atlas"></i>
                    </a>
                    <button id="theme-switcher" class="theme-switcher" title="切換主題">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button id="suicide-btn" class="header-link-btn" title="了卻此生">
                        <i class="fas fa-skull"></i>
                    </button>
                    <button id="logout-btn" class="header-link-btn" title="登出江湖">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            <div class="dashboard-content">
                <div class="info-card">
                    <div class="card-header-flex">
                        <h4><i class="fas fa-user"></i> 角色狀態 (PC)</h4>
                        <div class="header-action-group">
                            <span class="header-prompt-text">武學總覽→</span>
                            <button id="skills-btn" class="header-icon-btn" title="查看武學">
                                <i class="fas fa-khanda"></i>
                            </button>
                        </div>
                    </div>
                    <div id="pc-content">--</div>
                    <div class="power-display">
                        <span class="power-label">內功</span>
                        <div class="power-bar-container">
                            <div id="internal-power-bar" class="power-bar"></div>
                        </div>
                        <span id="internal-power-value" class="power-value">--/999</span>
                    </div>
                    <div class="power-display">
                        <span class="power-label">外功</span>
                        <div class="power-bar-container">
                            <div id="external-power-bar" class="power-bar"></div>
                        </div>
                        <span id="external-power-value" class="power-value">--/999</span>
                    </div>
                    <div class="power-display">
                        <span class="power-label">輕功</span>
                        <div class="power-bar-container">
                            <div id="lightness-power-bar" class="power-bar"></div>
                        </div>
                        <span id="lightness-power-value" class="power-value">--/999</span>
                    </div>
                    <div class="power-display">
                        <span class="power-label">精力</span>
                        <div class="power-bar-container">
                            <div id="stamina-bar" class="power-bar"></div>
                        </div>
                        <span id="stamina-value" class="power-value">--/100</span>
                    </div>
                </div>

                <div class="info-card">
                    <h4><i class="fa-solid fa-scale-unbalanced"></i> 立場傾向</h4>
                    <div id="morality-display" class="morality-display-container">
                        <span class="morality-label evil">邪</span>
                        <div class="morality-bar-background">
                            <div id="morality-bar-indicator" class="morality-bar-indicator"></div>
                        </div>
                        <span class="morality-label justice">正</span>
                    </div>
                </div>
                
                <div class="info-card">
                    <div class="card-header-flex">
                        <h4><i class="fas fa-map"></i> 當前地區</h4>
                        <div class="header-action-group">
                            <span class="header-prompt-text">世界地圖→</span>
                            <a href="map.html" target="_blank" id="map-btn" class="header-icon-btn" title="查看世界地圖">
                                <i class="fas fa-globe-asia"></i>
                            </a>
                        </div>
                    </div>
                    <div id="location-info">讀取中...</div>
                </div>
                <div class="info-card">
                    <h4><i class="fas fa-sack-dollar"></i> 錢袋</h4>
                    <div id="money-content" class="money-display">-- 文錢</div>
                </div>

                <div class="info-card">
                    <h4><i class="fas fa-briefcase"></i> 隨身物品 (ITM)</h4>
                    <div id="itm-content">--</div>
                </div>

                <div class="info-card">
                    <h4><i class="fas fa-users"></i> 人物見聞 (NPC)</h4>
                    <div id="npc-content">--</div>
                </div>

                <div class="info-card">
                    <div class="card-header-flex">
                        <h4><i class="fas fa-scroll"></i> 任務日誌 (QST)</h4>
                        <div class="header-action-group">
                            <span class="header-prompt-text">懸賞告示板→</span>
                            <a href="bounties.html" target="_blank" id="bounties-btn" class="header-icon-btn" title="查看懸賞">
                                <i class="fas fa-scroll"></i>
                            </a>
                        </div>
                    </div>
                    <div id="qst-content">--</div>
                </div>

                 <div class="info-card">
                    <h4><i class="fas fa-brain"></i> 內心獨白 (PSY)</h4>
                    <div id="psy-content">--</div>
                </div>
                
                <div class="info-card">
                    <h4><i class="fas fa-key"></i> 關鍵線索 (CLS)</h4>
                    <div id="cls-content">--</div>
                </div>
                
                <div class="info-card">
                    <h4><i class="fas fa-brain-circuit"></i> AI 核心</h4>
                    <div class="select-wrapper">
                        <select id="ai-model-selector">
                            <option value="gemini">Gemini (快 & 穩)</option>
                            <option value="openai" selected>GPT (強 & 貴)</option>
                            <option value="deepseek">DeepSeek (強 & 奇)</option>
                            <option value="grok">Grok (快 & 怪)</option>
                        </select>
                    </div>
                    <small class="ai-switcher-note">注意：更換核心後，故事風格與文筆將會改變。</small>
                </div>
            </div>
        </aside>

        <div id="epilogue-modal" class="epilogue-modal-overlay">
            <div class="epilogue-modal-content">
                <header class="epilogue-modal-header">
                    <h2 id="epilogue-title">江湖路遠 有緣再會</h2>
                </header>
                <div id="epilogue-story" class="epilogue-modal-body">
                    <div class="loading-placeholder">
                        <p>史官正在為您的人生撰寫終章...</p>
                        <div class="loader-dots">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
                <footer class="epilogue-modal-footer">
                    <button id="close-epilogue-btn" class="epilogue-btn">查看結局</button>
                </footer>
            </div>
        </div>

        <div id="deceased-overlay" class="deceased-overlay">
            <div class="deceased-content">
                <i class="fas fa-book-dead"></i>
                <h2 id="deceased-title">江湖路遠，就此終焉</h2>
                <p id="deceased-message">你已身故。此世的傳奇已載入史冊，永世流傳。</p>
                <div class="deceased-actions">
                    <a href="library.html" target="_blank" class="deceased-btn review-btn">
                        <i class="fas fa-book-open-reader"></i> 回顧生平事蹟
                    </a>
                    <a href="register.html" class="deceased-btn restart-btn">
                        <i class="fas fa-user-plus"></i> 註冊新名號
                    </a>
                </div>
            </div>
        </div>
        
        <div id="combat-modal" class="combat-modal-overlay">
            <div class="combat-modal-content">
                <button id="close-combat-btn" class="combat-close-btn" title="取消戰鬥"><i class="fas fa-times"></i></button>
                <div class="combat-dashboard">
                    <div id="allies-roster" class="roster-panel"></div>
                    <div id="enemies-roster" class="roster-panel"></div>
                </div>
                <div class="combat-main-panel">
                    <div id="combat-log" class="combat-log-area"></div>
                    <div class="combat-actions-container">
                        <div id="combat-turn-counter" class="combat-turn-counter"></div>
                        <div id="combat-actions-panel" class="combat-actions-panel">
                            <div id="strategy-buttons" class="strategy-buttons">
                                <button class="strategy-btn" data-strategy="attack"><i class="fas fa-gavel"></i> 攻擊</button>
                                <button class="strategy-btn" data-strategy="defend"><i class="fas fa-shield-alt"></i> 防禦</button>
                                <button class="strategy-btn" data-strategy="evade"><i class="fas fa-running"></i> 迴避</button>
                                <button class="strategy-btn" data-strategy="support"><i class="fas fa-hands-helping"></i> 輔助</button>
                                <button class="strategy-btn" data-strategy="heal"><i class="fas fa-briefcase-medical"></i> 治癒</button>
                            </div>
                            <div id="skill-selection" class="skill-selection"></div>
                            <div id="confirm-action" class="confirm-action"></div>
                        </div>
                    </div>
                </div>
                 <div id="combat-loader" class="combat-loader-overlay">
                    <div class="loader-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>

        <div id="chat-modal" class="chat-modal-overlay">
            <div class="chat-modal-content">
                <div class="chat-header">
                    <h3 id="chat-npc-name">與...交談</h3>
                    <div id="chat-npc-info" class="chat-npc-info-list"></div>
                    <div class="chat-close-container">
                        <small class="chat-close-tip">(取消對話)</small>
                        <button id="close-chat-btn" class="chat-close-btn" title="關閉視窗"><i class="fas fa-times"></i></button>
                    </div>
                </div>
                <div id="chat-log" class="chat-log-area">
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="你說..." autocomplete="off">
                    <button id="chat-action-btn">發送</button>
                    <button id="give-item-btn" class="chat-action-btn give-item-btn" title="贈予物品或金錢">
                        <i class="fas fa-hand-holding-dollar"></i>
                    </button>
                </div>
                <div class="chat-footer">
                    <button id="end-chat-btn" class="end-chat-btn">結束交談</button>
                </div>
                 <div id="chat-loader" class="chat-loader-overlay">
                    <div class="loader-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>

        <div id="give-item-modal" class="chat-modal-overlay">
            <div class="chat-modal-content">
                <div class="chat-header">
                    <h3 id="give-item-title">要贈予什麼？</h3>
                    <button id="cancel-give-btn" class="chat-close-btn" title="取消贈予"><i class="fas fa-times"></i></button>
                </div>
                <div id="give-inventory-list" class="chat-log-area">
                    </div>
                <div class="chat-footer">
                    <p>選擇一項物品來贈予。</p>
                </div>
            </div>
        </div>

        <div id="skills-modal" class="skills-modal-overlay">
            <div class="skills-modal-content">
                <div class="skills-modal-header">
                    <h3>武學總覽</h3>
                    <button id="close-skills-btn" class="skills-modal-close"><i class="fas fa-times"></i></button>
                </div>
                <div class="skills-modal-tabs" id="skills-tabs-container">
                    </div>
                <div class="skills-modal-body" id="skills-body-container">
                    </div>
            </div>
        </div>

        <div id="gm-panel" class="gm-panel-overlay">
            <div class="gm-panel-container">
                <nav class="gm-panel-nav">
                    <header class="gm-panel-header">
                        <i class="fa-solid fa-wand-magic-sparkles gm-icon"></i>
                        <h2>創世神<br>控制台</h2>
                    </header>
                    <ul id="gm-menu" class="gm-panel-menu">
                        <li class="gm-menu-item"><a href="#player-stats" class="active"><i class="fa-solid fa-user-pen"></i> 玩家屬性</a></li>
                        <li class="gm-menu-item"><a href="#npc-management"><i class="fa-solid fa-users-gear"></i> NPC 管理</a></li>
                        <li class="gm-menu-item"><a href="#location-editor"><i class="fa-solid fa-map-location-dot"></i> 地區編輯</a></li>
                        <li class="gm-menu-item"><a href="#item-spawner"><i class="fa-solid fa-box-archive"></i> 物品生成</a></li>
                    </ul>
                    <footer class="gm-panel-footer">
                        <button id="gm-close-btn" class="gm-close-btn">關閉面板</button>
                    </footer>
                </nav>
                <div id="gm-content" class="gm-panel-content">
                    <div id="player-stats" class="gm-page active">
                        </div>
                    <div id="npc-management" class="gm-page">
                        <h3>NPC關係管理</h3>
                        <p>此處將允許您查看和修改所有NPC的好感度、心動值，甚至修復「黑戶」NPC。功能開發中...</p>
                    </div>
                     <div id="location-editor" class="gm-page">
                        </div>
                    <div id="item-spawner" class="gm-page">
                        <h3>物品/裝備生成</h3>
                        <p>此處將允許您為自己或遊戲世界添加任何物品。功能開發中...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="trade-modal" class="fixed inset-0 bg-black/75 backdrop-blur-sm flex-col items-center justify-center p-2 hidden">
            <div class="bg-transparent w-full max-w-6xl h-[95vh] max-h-[800px] flex flex-col">
                <header class="p-2 flex-shrink-0">
                    <h2 class="text-2xl md:text-3xl font-serif text-center text-amber-100/90 [text-shadow:_0_2px_2px_rgb(0_0_0_/_50%)]">
                        <i class="fas fa-balance-scale-right mr-2"></i>貨物交割
                    </h2>
                </header>
                <main class="flex-grow flex flex-col md:flex-row gap-4 overflow-hidden p-2">
                    <div id="trade-player-panel" class="w-full md:w-1/3 flex flex-col gap-3 p-3 rounded-lg transition-shadow duration-500" style="background-color: #f5eeda;">
                        <div class="text-center flex-shrink-0">
                            <h3 class="font-serif text-xl text-black">你</h3>
                            <div class="text-sm text-gray-600 flex items-center justify-center gap-1">
                                <i class="fas fa-coins text-yellow-600"></i>
                                <span id="trade-player-money">1500</span>
                            </div>
                        </div>
                        <div class="flex-grow border-2 border-dashed border-[#d4cba7] rounded p-2 overflow-y-auto">
                            <p class="text-xs text-center text-gray-500 mb-2">你的行囊</p>
                            <ul id="trade-player-inventory" class="space-y-2"></ul>
                        </div>
                    </div>
                    <div class="w-full md:w-1/3 flex flex-col gap-3 order-first md:order-none">
                        <div id="trade-npc-offer-panel" class="h-1/2 flex flex-col p-3 rounded-lg transition-shadow duration-500" style="background-color: #f5eeda;">
                            <h4 id="trade-npc-name" class="font-serif text-center text-lg text-black border-b-2 border-dashed border-[#d4cba7] pb-2 mb-2"></h4>
                            <ul id="trade-npc-offer" class="flex-grow space-y-2 overflow-y-auto pr-1"></ul>
                        </div>
                        <div class="flex-shrink-0 bg-black/30 p-3 rounded-lg flex flex-col items-center justify-center gap-2 text-center">
                            <div class="font-serif text-amber-100 text-lg">價值差</div>
                            <div id="trade-value-diff" class="text-2xl font-bold text-white">0</div>
                            <button id="confirm-trade-btn" class="bg-amber-600 text-white font-serif font-bold text-lg py-2 px-10 rounded-md shadow-md hover:bg-amber-500 transition-colors disabled:bg-gray-500 disabled:cursor-not-allowed" disabled>成交</button>
                        </div>
                        <div id="trade-player-offer-panel" class="h-1/2 flex flex-col p-3 rounded-lg transition-shadow duration-500" style="background-color: #f5eeda;">
                            <h4 class="font-serif text-center text-lg text-black border-b-2 border-dashed border-[#d4cba7] pb-2 mb-2">你的出價</h4>
                            <ul id="trade-player-offer" class="flex-grow space-y-2 overflow-y-auto pr-1"></ul>
                        </div>
                    </div>
                    <div id="trade-npc-panel" class="w-full md:w-1/3 flex flex-col gap-3 p-3 rounded-lg transition-shadow duration-500" style="background-color: #f5eeda;">
                        <div class="text-center flex-shrink-0">
                            <h3 id="trade-npc-header-name" class="font-serif text-xl text-black"></h3>
                            <div class="text-sm text-gray-600 flex items-center justify-center gap-1">
                                <i class="fas fa-coins text-yellow-600"></i>
                                <span id="trade-npc-money">800</span>
                            </div>
                        </div>
                        <div class="flex-grow border-2 border-dashed border-[#d4cba7] rounded p-2 overflow-y-auto">
                            <p class="text-xs text-center text-gray-500 mb-2">對方的貨物</p>
                            <ul id="trade-npc-inventory" class="space-y-2"></ul>
                        </div>
                    </div>
                </main>
            </div>
        </div>


    </div>

    <script type="module" src="scripts/main.js"></script>
</body>
</html>
